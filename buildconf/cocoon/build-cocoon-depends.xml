<?xml version="1.0" encoding="UTF-8"?>
<project basedir="../../" default="prepare-cocoon" name="xMod Cocoon Dependencies">
  <import file="../../build.xml" />

  <property location="cocoon" name="cocoon.dir" />
  <property location="${build.dir}/cocoon" name="cocoon.build.dir" />
  <property location="${cocoon.build.dir}/xml" name="cocoon.xml.build.dir" />
  <property location="${cocoon.xml.build.dir}/content" name="cocoon.content.build.dir" />

  <target depends="prepare, prepare-metadata" name="prepare-cocoon">
    <antcall target="copy-cocoon" />
    <antcall target="create-properties-xslt" />
    <antcall target="copy-src" />
    <antcall target="copy-metadata" />
    <antcall target="copy-assets" />
    <antcall target="copy-images" />
    <antcall target="copy-schema" />
  </target>

  <target name="copy-cocoon" depends="prepare">
    <query name="username" />
    <query name="password" password="true" />
    
    <svn javahl="${svnant.javahl}" password="${password}" username="${username}">
      <checkout url="${svn.cocoon.url}" destPath="${cocoon.build.dir}" />
    </svn>
    <copy todir="${cocoon.build.dir}">
      <fileset dir="${cocoon.dir}/sitemap" includes="*.xmap" />
    </copy>
    <copy todir="${cocoon.build.dir}/WEB-INF/lib">
      <fileset dir="${cocoon.dir}/lib" />
    </copy>
  </target>
  
  <target depends="prepare" name="create-properties-xslt">
    <xslt in="${properties.dir}/properties.xml" out="${style.dir}/properties/properties.xsl"
      style="${style.dir}/properties/properties-generator.xsl">
      <factory name="net.sf.saxon.TransformerFactoryImpl" />
    </xslt>
    
    <copy todir="${cocoon.build.dir}/stylesheets">
      <fileset dir="${style.dir}" />
    </copy>
  </target>
  
  <target name="copy-src" depends="prepare">
    <copy todir="${cocoon.content.build.dir}">
      <fileset dir="${source.dir}" />
    </copy>
  </target>
  
  <target name="copy-metadata" depends="prepare">
    <copy todir="${cocoon.xml.build.dir}/metadata">
      <fileset dir="${metadata.dir}" />
    </copy>
    
    <copy todir="${cocoon.xml.build.dir}/menu">
      <fileset dir="${menu.dir}" />
    </copy>
    
    <copy todir="${cocoon.xml.build.dir}/properties">
      <fileset dir="${properties.dir}" />
    </copy>    
  </target>
  
  <target depends="prepare" name="copy-assets">
    <copy todir="${cocoon.build.dir}/${assets.dir.name}">
      <fileset dir="${assets.dir}" />
    </copy>
  </target>
  
  <target depends="prepare" name="copy-images">
    <copy todir="${cocoon.build.dir}/${images.dir.name}">
      <fileset dir="${images.dir}" />
    </copy>
  </target>
  
  <target depends="prepare" name="copy-schema">
    <copy todir="${cocoon.build.dir}/${schema.dir.name}">
      <fileset dir="${schema.dir}" />
    </copy>
  </target>
</project>
